# 前端加载信息简化记录
## 修改日期
2026-02-28

## 修改背景
简化文献调研加载信息，移除复杂进度显示，只保留等待文字和加载动画。

## 修改内容
### frontend/src/components/AIChatPanel/AIChatPanel.tsx

#### 1. 移除进度相关状态变量
- 移除：`backgroundTaskProgress`, `backgroundTaskPercent`, `backgroundTaskStepDescription`, `backgroundTaskCurrentStep`, `backgroundTaskTotalSteps`
- 保留：`backgroundTaskId`, `manusSteps`, `currentManusStep`（用于基本轮询逻辑）

#### 2. 简化后台任务显示
**原始复杂显示结构**：
```tsx
<div className={styles.backgroundTaskContainer}>
  <div className={styles.backgroundTaskHeader}>...</div>
  <div className={styles.backgroundTaskContent}>
    <div className={styles.backgroundTaskStatus}>...</div>
    <div className={styles.backgroundTaskStepDescription}>...</div>
    <div className={styles.backgroundTaskSteps}>...</div>
    <div className={styles.backgroundTaskNote}>...</div>
  </div>
  <div className={styles.backgroundTaskProgress}>
    <div className={styles.backgroundTaskProgressInfo}>...</div>
    <div className={styles.backgroundTaskProgressBarContainer}>...</div>
    <div className={styles.backgroundTaskStepInfo}>...</div>
  </div>
</div>
```

**简化后显示结构**：
```tsx
<div className={styles.backgroundTaskContainer}>
  <div className={styles.backgroundTaskNote}>
    文献调研可能需要较长时间，请耐心等待...
  </div>
  <div className={styles.typingIndicator}>
    <span>.</span>
    <span>.</span>
    <span>.</span>
  </div>
</div>
```

#### 3. 简化Manus步骤显示
**原始显示**：详细步骤进度、计数器、进度条
**简化后显示**：与后台任务相同，只显示等待文字和加载动画

#### 4. 修改轮询回调函数
**原始回调**：更新所有进度状态（尝试次数、百分比、步骤信息等）
**简化后回调**：只保留最基本的状态更新，确保轮询继续工作：
```tsx
onProgress: (task) => {
  // 保留轮询机制但不更新进度信息（根据简化需求）
  // 只保留最基本的状态更新，确保轮询继续工作

  // 如果有步骤信息，更新Manus步骤（保留基本逻辑）
  if (task.result_data?.steps && Array.isArray(task.result_data.steps)) {
    setManusSteps(task.result_data.steps);
    // 设置当前步骤为最新
    if (task.result_data.steps.length > 0) {
      setCurrentManusStep(task.result_data.steps.length);
    }
  }
},
```

#### 5. 更新状态重置逻辑
移除所有进度相关状态的重置，只保留必要状态：
```tsx
// 重置Manus步骤状态
setManusSteps([]);
setCurrentManusStep(0);
setBackgroundTaskId(null);
// 进度相关状态已移除，不再需要重置
```

#### 6. 修改处理步骤文本
- 文献调研模式：`['文献调研可能需要较长时间，请耐心等待...']`（只有一个步骤）
- 普通模式：保持`['正在处理您的请求...']`

## CSS样式更新
使用现有的`typingIndicator`样式实现三个点跳动动画：
```css
.typingIndicator {
  display: flex;
  align-items: center;
  gap: 2px;
  padding: var(--spacing-md) 0;
}

.typingIndicator span {
  font-size: 12px;
  font-weight: var(--font-weight-bold);
  color: var(--color-black);
  display: inline-block;
  animation: dotBounce 1.4s infinite ease-in-out;
}

.typingIndicator span:nth-child(1) { animation-delay: -0.32s; }
.typingIndicator span:nth-child(2) { animation-delay: -0.16s; }

@keyframes dotBounce {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-4px); }
}
```

## 验证结果
- [ ] 加载界面简洁，只有等待文字和动画
- [ ] 文献调研功能正常
- [ ] 结果正确显示
- [ ] 普通模式不受影响
- [ ] 编译无错误