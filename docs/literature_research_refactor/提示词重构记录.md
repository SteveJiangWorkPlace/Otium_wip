# 文献调研提示词重构记录
## 修改日期
2026-02-28

## 修改背景
将硬编码的文献调研提示词迁移到`prompts.py`模板系统，保持架构一致性。

## 新增函数
### `build_literature_research_prompt_original()`
位置：`backend/prompts.py`
功能：构建文献调研提示词（原始版本）
参数：`prompt` (用户输入), `generate_literature_review` (是否生成文献综述)

### `build_literature_research_prompt()`
生产版本，与原始版本相同，但包含缓存和性能监控。

## 配置常量
在`prompts.py`中添加：
- `LITERATURE_RESEARCH_TEMPLATE_VERSION = "1.0.0"` - 模板版本标识

## 修改文件
### backend/prompts.py
- 添加两个新函数：`build_literature_research_prompt_original()`和`build_literature_research_prompt()`
- 更新导出列表：添加`'build_literature_research_prompt'`和`'build_literature_research_prompt_original'`
- 添加配置常量`LITERATURE_RESEARCH_TEMPLATE_VERSION`

### backend/api_services.py
- 添加导入：`from prompts import build_literature_research_prompt`
- 替换第1388-1413行的硬编码提示词：
  ```python
  # 使用新的提示词模板系统
  final_prompt = build_literature_research_prompt(
      prompt=prompt,
      generate_literature_review=generate_literature_review,
      use_cache=True,  # 启用缓存提高性能
  )
  ```
- 保持`prompt_already_built`参数逻辑不变
- 添加导入注释说明新模板系统

### backend/main.py
- 添加导入：`from prompts import build_literature_research_prompt`
- 替换第1776-1800行的硬编码提示词：
  ```python
  # 使用新提示词模板系统构建文献调研提示词
  final_prompt = build_literature_research_prompt(
      prompt=prompt,
      generate_literature_review=request.generate_literature_review,
      use_cache=True,  # 启用缓存提高性能
  )
  ```
- 更新日志消息，记录使用新模板系统

## 验证结果
- [ ] 提示词构建测试通过
- [ ] Manus API调用正常
- [ ] 结果格式符合预期
- [ ] 生产环境下使用新模板系统