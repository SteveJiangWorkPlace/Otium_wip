# pytest 配置文件
# 用于配置测试运行行为

[pytest]
# 测试文件模式
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# 异步测试配置
asyncio_mode = auto

# 测试发现配置
norecursedirs = .git .venv venv env build dist *.egg-info

# 测试运行配置
addopts =
    --verbose
    --color=yes
    --tb=short
    --strict-markers
    --strict-config
    -p no:warnings

# 覆盖率配置
# 使用 pytest-cov 时取消注释以下行
# --cov=.
# --cov-report=term-missing
# --cov-report=html
# --cov-report=xml
# --cov-fail-under=80

# 标记定义
markers =
    slow: 运行缓慢的测试
    integration: 集成测试
    unit: 单元测试
    api: API 测试
    auth: 认证相关测试
    text: 文本处理测试
    admin: 管理员功能测试

# 测试超时设置（秒）
timeout = 30
timeout_method = thread

# 日志配置
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(message)s
log_cli_date_format = %H:%M:%S

# 测试环境变量
# 这些变量会在测试运行时设置
env =
    TESTING=True
    ENVIRONMENT=testing
    DEBUG=False
    SECRET_KEY=test-secret-key-for-testing-only
    GEMINI_API_KEY=test-gemini-key
    GPTZERO_API_KEY=test-gptzero-key
    CORS_ORIGINS=http://localhost:3000,http://localhost:8000
    DATABASE_TYPE=sqlite
    DATABASE_PATH=./data/test.db
    LOG_LEVEL=WARNING
    LOG_TO_CONSOLE=False